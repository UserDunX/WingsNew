<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatAI - Asisten AI Mirip ChatGPT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }
        body {
            background-color: #343541;
            color: #ececf1;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .header {
            background-color: #202123;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #4a4e5e;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .logo::before {
            content: "ðŸ¤–";
            font-size: 1.5rem;
        }
        .status {
            font-size: 0.875rem;
            color: #8e8ea0;
        }
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            background-color: #343541;
        }
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            scrollbar-width: thin;
            scrollbar-color: #565869 #343541;
        }
        .messages-container::-webkit-scrollbar {
            width: 6px;
        }
        .messages-container::-webkit-scrollbar-track {
            background: #343541;
        }
        .messages-container::-webkit-scrollbar-thumb {
            background: #565869;
            border-radius: 3px;
        }
        .welcome-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            color: #8e8ea0;
        }
        .welcome-message h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .welcome-message p {
            font-size: 1rem;
        }
        .message {
            display: flex;
            max-width: 70%;
            margin-bottom: 0;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .message.ai {
            align-self: flex-start;
        }
        .message-bubble {
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            max-width: 100%;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
        }
        .message.user .message-bubble {
            background-color: #10a37f;
            color: white;
            border-bottom-right-radius: 0.375rem;
        }
        .message.ai .message-bubble {
            background-color: #444654;
            color: #ececf1;
            border-bottom-left-radius: 0.375rem;
        }
        .message-time {
            font-size: 0.75rem;
            color: #8e8ea0;
            margin-top: 0.25rem;
            text-align: right;
        }
        .input-area {
            background-color: #40414f;
            padding: 1rem 2rem;
            border-top: 1px solid #565869;
            display: flex;
            align-items: flex-end;
            gap: 1rem;
        }
        .message-input {
            flex: 1;
            background: transparent;
            border: 1px solid #565869;
            color: #ececf1;
            font-size: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            resize: none;
            outline: none;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.5;
        }
        .message-input:focus {
            border-color: #10a37f;
        }
        .message-input::placeholder {
            color: #8e8ea0;
        }
        .send-btn {
            background-color: #10a37f;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            min-width: 60px;
            height: 40px;
        }
        .send-btn:hover:not(:disabled) {
            background-color: #0d8b6a;
        }
        .send-btn:disabled {
            background-color: #565869;
            cursor: not-allowed;
        }
        .loading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.25rem;
            background-color: #444654;
            border-radius: 0.75rem;
            max-width: 70%;
            align-self: flex-start;
            border-bottom-left-radius: 0.375rem;
        }
        .loading-dots {
            display: flex;
            gap: 0.25rem;
        }
        .loading-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: #8e8ea0;
            border-radius: 50%;
            animation: bounce 1.4s ease-in-out infinite both;
        }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        .error {
            color: #ff6b6b;
            background-color: #444654;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ChatAI</div>
        <div class="status">Asisten AI Canggih - Mirip ChatGPT</div>
    </div>

    <div class="chat-container">
        <div id="messages-container" class="messages-container">
            <div class="welcome-message">
                <div>
                    <h3>Selamat Datang!</h3>
                    <p>Mulai chat dengan AI. Tanyakan apapun, seperti "Jelaskan relativitas Einstein" atau "Buat resep nasi goreng".</p>
                </div>
            </div>
        </div>

        <div class="input-area">
            <textarea 
                id="message-input" 
                class="message-input" 
                placeholder="Ketik pesan Anda di sini... (Enter untuk kirim, Shift+Enter untuk baris baru)"
                rows="1"
            ></textarea>
            <button id="send-button" class="send-btn">Kirim</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const messagesContainer = document.getElementById('messages-container');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            
            let messages = []; // Riwayat chat untuk konteks
            let isLoading = false;

            // Konfigurasi OpenAI API - GANTI DENGAN API KEY ANDA!
            const OPENAI_API_KEY = 'YOUR_OPENAI_API_KEY'; // Masukkan API key OpenAI di sini (contoh: 'sk-proj-abc123...')
            const OPENAI_API_URL = 'https://api.openai.com/v1/chat/completions';

            console.log('ChatAI dimulai. Pastikan API key diset untuk AI nyata.');

            // Auto-resize textarea
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 200) + 'px';
            });

            // Fungsi scroll ke bawah
            function scrollToBottom() {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            // Fungsi tambah pesan user (DIPERBAIKI: nama fungsi tanpa spasi)
            function addUser Message(content) {
                console.log('Menambahkan pesan user:', content);
                const message = {
                    id: Date.now(),
                    role: 'user',
                    content: content,
                    timestamp: new Date()
                };
                messages.push(message);
                renderMessages();
                scrollToBottom();
            }

            // Fungsi tambah pesan AI
            function addAIMessage(content, isError = false) {
                console.log('Menambahkan respons AI:', content);
                const message = {
                    id: Date.now() + 1,
                    role: 'assistant',
                    content: content,
                    timestamp: new Date(),
                    isError: isError
                };
                messages.push(message);
                renderMessages();
                scrollToBottom();
            }

            // Fungsi panggil OpenAI API (dengan logging untuk debug)
            async function getAIResponse(userMessage) {
                console.log('Memanggil OpenAI API untuk:', userMessage);
                if (!OPENAI_API_KEY || OPENAI_API_KEY === 'YOUR_OPENAI_API_KEY') {
                    console.warn('API key tidak diset, menggunakan fallback simulasi.');
                    return `Respons simulasi: Terima kasih atas pertanyaan "${userMessage}". Saya adalah AI mirip ChatGPT yang bisa menjawab berbagai topik. Set API key untuk respons nyata dan dinamis!`;
                }

                try {
                    // Payload dengan system prompt dan riwayat (max 10 pesan untuk konteks)
                    const messagesPayload = [
                        { 
                            role: 'system', 
                            content: 'Kamu adalah asisten AI yang ramah, pintar, dan mirip ChatGPT. Jawab secara detail, akurat, dan bermanfaat. Gunakan bahasa yang sesuai dengan pengguna (Indonesia jika input dalam bahasa itu). Jangan sebutkan bahwa kamu adalah AI kecuali ditanya.' 
                        },
                        ...messages.slice(-10).map(msg => ({ role: msg.role, content: msg.content }))
                    ];

                    const response = await fetch(OPENAI_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${OPENAI_API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo', // Bisa ganti ke 'gpt-4o-mini' untuk lebih baik
                            messages: messagesPayload,
                            max_tokens: 1000, // Panjang respons maksimal
                            temperature: 0.7 // Kreativitas (0-1)
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`API Error: ${response.status} - ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('Respons AI diterima:', data.choices[0].message.content);
                    return data.choices[0].message.content.trim();
                } catch (error) {
                    console.error('Error OpenAI API:', error);
                    return `Maaf, ada kesalahan saat menghubungi AI: ${error.message}. Pastikan API key valid, internet stabil, dan coba lagi.`;
                }
            }

            // Fungsi render pesan
            function renderMessages() {
                const welcome = messagesContainer.querySelector('.welcome-message');
                if (welcome) welcome.remove();

                messagesContainer.innerHTML = '';
                
                messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `message ${message.role}`;
                    
                    const bubble = document.createElement('div');
                    bubble.className = `message-bubble ${message.isError ? 'error' : ''}`;
                    bubble.innerHTML = `
                        <div>${escapeHtml(message.content)}</div>
                        <div class="message-time">${formatTime(message.timestamp)}</div>
                    `;
                    
                    messageDiv.appendChild(bubble);
                    messagesContainer.appendChild(messageDiv);
                });

                if (isLoading) {
                    const loadingDiv = document.createElement('div');
                    loadingDiv.className = 'loading';
                    loadingDiv.innerHTML = `
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                        <div>AI sedang berpikir...</div>
                    `;
                    messagesContainer.appendChild(loadingDiv);
                    scrollToBottom();
                }
            }

            // Escape HTML untuk keamanan
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Format waktu
            function formatTime(date) {
                return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            }

            // Fungsi kirim pesan (dengan logging)
            async function sendMessage() {
                const userMessage = messageInput.value.trim();
                console.log('Mencoba kirim pesan:', userMessage);
                if (!userMessage || isLoading) {
                    console.log('Pesan kosong atau sedang loading, dibatalkan.');
                    return;
                }

                addUser Message(userMessage);
                messageInput.value = '';
                messageInput.style.height = 'auto';
                isLoading = true;
                sendButton.disabled = true;
                sendButton.textContent = 'Mengirim...';
                renderMessages();

                try {
                    const aiResponse = await getAIResponse(userMessage);
                    addAIMessage(aiResponse, aiResponse.includes('kesalahan') || aiResponse.includes('Error'));
                } catch (error) {
                    console.error('Error di sendMessage:', error);
                    addAIMessage(`Error tak terduga: ${error.message}`, true);
                } finally {
                    isLoading = false;
                    sendButton.disabled = false;
                    sendButton.textContent = 'Kirim';
                    renderMessages();
                }
            }

            // Event listeners
            sendButton.addEventListener('click', sendMessage);

            message
